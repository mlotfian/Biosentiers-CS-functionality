<!DOCTYPE html>
<html>
{% load leaflet_tags %}
{% leaflet_js %}
{% leaflet_css %}
{% load static %}
<head>

    <title>Map Page</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="{% static 'index.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script
        src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js">

    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
    integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
    integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA==" crossorigin=""></script>

   <!-- marker clusetr -->
   <link rel="stylesheet" href="{% static 'markercluster.css' %}">
   <script src="{% static 'markercluster.js' %}">

   </script>
   <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js'></script>
   <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.css" />
   <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.Default.css" />

      <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }



.navbar a {
  float: left;
  padding: 10px;
  color: white;
  text-decoration: none;
  font-size: 17px;
}

.navbar a:hover {
  background-color: #000;
}

.active {
  background-color: #4CAF50;
}
img {
  max-width: 150px;
  max-height: 200px;
}

    </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="active" href="{% url 'index' %}"><i class="fa fa-fw fa-home"></i> Home</a>

</nav>


    {% leaflet_map "map" callback="window.map_init_basic" %}
    {% autoescape off %}
    <script>


        var map = L.map('map').setView([46.7833,6.65],12);

        L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=9GKOA9jJ3jCIWFUd8k00', {attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',}).addTo(map);
        const jsonFeatures = {{ points_json | safe }}

          L.geoJSON(jsonFeatures, {
          onEachFeature: function (feature, layer) {
            layer.bindPopup('<p><strong>Species Type: </strong>'+feature.properties.obs_type+'</p><p><strong>Species Name: </strong>' + feature.properties.name + '</p><p><strong>Observation Date: </strong>' + feature.properties.date + '</p><img src=/media/' + feature.properties.photo + '/>', {maxWidth: "auto"});
          }
        }).addTo(map);

// centring the popup arrow to the marker
        document.querySelector(".leaflet-popup-pane").addEventListener("load", function (event) {
	         var target = event.target,
  		         tagName = target.tagName,
               popup = map._popup;

        console.log("got load event from " + tagName);

        if (tagName === "IMG" && popup) {
  	       popup.update();
         }
       }, true);


    </script>
    {% endautoescape %}


</body>
</html>
